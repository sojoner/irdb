# Development environment overrides
# Deploy with: helm install irdb-postgres . -f values-dev.yaml

# Enable NodePort for local network access
nodePort:
  enabled: true
  nodePort: 30432  # Fixed port for development
  port: 5432

# Image configuration for Catalog
image:
  registry: docker.io
  repository: sojoner/database
  tag: 0.0.8
  majorVersion: 17

cnpg:
  # Override Postgres version for CNPG chart logic
  version:
    postgresql: "17"

  cluster:
    instances: 1  # Single instance for development
    # imageName: sojoner/database:0.0.8  # Removed in favor of imageCatalogRef
    imageCatalogRef:
      kind: ClusterImageCatalog
      name: sojoner-catalog
      major: 17
    
    # Standard Postgres image uses UID 999
    postgresUID: 999
    postgresGID: 999

    # Reduced resources for development
    resources:
      requests:
        memory: 512Mi
        cpu: 500m
      limits:
        memory: 1Gi
        cpu: 1000m

    # Smaller storage
    storage:
      size: 5Gi
      storageClass: local-path

    # No sync replication needed for single instance
    minSyncReplicas: 0
    maxSyncReplicas: 0

    # Disable affinity for single-node clusters
    affinity:
      enablePodAntiAffinity: false

    # More verbose logging for development
    postgresql:
      parameters:
        log_min_duration_statement: "100"  # Log queries > 100ms
        log_statement: "all"  # Log all statements
      shared_preload_libraries:
        - pg_search
        - pg_stat_statements
    
    # Bootstrap configuration (initdb)
    initdb:
      postInitApplicationSQL:
        - CREATE EXTENSION IF NOT EXISTS vector;
        - CREATE EXTENSION IF NOT EXISTS pg_stat_statements;
        - CREATE EXTENSION IF NOT EXISTS pg_trgm;
        - CREATE EXTENSION IF NOT EXISTS btree_gin;
        - CREATE EXTENSION IF NOT EXISTS pg_search;

catalog:
  enabled: true
  name: sojoner-catalog
